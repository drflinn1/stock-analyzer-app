name: Kraken â€” 1-Coin Rotation (Monday Baseline)

on:
  workflow_dispatch:
    inputs:
      SYMBOL:
        description: "Trading pair (e.g., BTC/USD, SOL/USD)"
        required: true
        default: "BTC/USD"
      BUY_USD:
        description: "USD notional to buy when flat"
        required: true
        default: "10"
      TP_PCT:
        description: "Take-profit % (e.g., 5 = +5%)"
        required: true
        default: "5"
      SL_PCT:
        description: "Stop-loss % (e.g., 2 = -2%)"
        required: true
        default: "2"
      DRY_RUN:
        description: "ON = simulate orders; OFF = place REAL Kraken orders"
        required: true
        default: "ON"   # ALWAYS start in DRY mode

jobs:
  kraken-rotation:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install ccxt requests

      - name: Run Kraken 1-coin rotation bot
        env:
          # Secrets (you already have these from the old bot)
          KRAKEN_API_KEY: ${{ secrets.KRAKEN_API_KEY }}
          KRAKEN_API_SECRET: ${{ secrets.KRAKEN_API_SECRET }}

          # Inputs
          SYMBOL:  ${{ github.event.inputs.SYMBOL }}
          BUY_USD: ${{ github.event.inputs.BUY_USD }}
          TP_PCT:  ${{ github.event.inputs.TP_PCT }}
          SL_PCT:  ${{ github.event.inputs.SL_PCT }}
          DRY_RUN: ${{ github.event.inputs.DRY_RUN }}
        run: |
          python kraken_monday_main.py

      - name: Upload state & summary
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: kraken-rotation-state
          path: |
            .state/kraken_positions.json
            .state/kraken_run_summary.md
          if-no-files-found: ignore
