name: Sell Logic Guard
on:
  push:
    branches: [ main ]
  schedule:
    - cron: "15 07 * * *"  # daily check at 07:15 UTC

jobs:
  verify-sell-logic:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Ensure sell logic present in main.py
        run: |
          python - <<'PY'
          import re,sys,io
          with io.open('main.py','r',encoding='utf-8') as f:
              t=f.read()
          required = [
              r'\bSELL\b',
              r'(TAKE_PROFIT|take_profit)',
              r'(TRAIL|trailing)',
              r'(STOP_LOSS|stop_loss)'
          ]
          missing=[p for p in required if not re.search(p,t)]
          if missing:
              print("❌ Missing sell patterns:", missing)
              sys.exit(1)
          print("✅ Sell logic guard OK")
          PY
