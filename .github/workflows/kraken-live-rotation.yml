# =====================================================================================
#  âš âš âš   WARNING â€” LIVE KRAKEN TRADING WORKFLOW  âš âš âš 
#
#  - This workflow sends REAL ORDERS to Kraken when run.
#  - DRY_RUN is HARD-CODED to "OFF" in this file.
#  - Default BUY_USD is SMALL ($5), but it is still REAL MONEY.
#
#  SAFETY TIPS:
#    * Only run this manually from the "Actions" tab.
#    * DOUBLE-CHECK: SYMBOL, BUY_USD, TP/SL, and your Kraken balances first.
#    * NEVER add a schedule block unless you are 100% sure.
#
#  If you just want to SIMULATE trades, use your DRY-RUN workflow instead.
# =====================================================================================

name: Kraken â€” 1-Coin Rotation (LIVE)

on:
  # Manual only â€“ no schedule for LIVE
  workflow_dispatch:
    inputs:
      SYMBOL:
        description: "Trading pair (e.g., SOL/USD, TRX/USD)"
        required: true
        default: "SOL/USD"
      BUY_USD:
        description: "USD notional to buy when flat"
        required: true
        default: "5"
      TP_PCT:
        description: "Take-profit % (e.g., 8 = 8%)"
        required: true
        default: "8"
      SL_PCT:
        description: "Stop-loss % (e.g., 1 = 1%)"
        required: true
        default: "1"

jobs:
  live-rotation:
    runs-on: ubuntu-latest

    # Only one LIVE run at a time
    concurrency:
      group: kraken-live-rotation
      cancel-in-progress: false

    env:
      PYTHONUNBUFFERED: "1"

      # Inputs from the manual dispatch
      SYMBOL:  ${{ github.event.inputs.SYMBOL }}
      BUY_USD: ${{ github.event.inputs.BUY_USD }}
      TP_PCT:  ${{ github.event.inputs.TP_PCT }}
      SL_PCT:  ${{ github.event.inputs.SL_PCT }}

      # Kraken API credentials (must be set in repo secrets)
      KRAKEN_API_KEY:    ${{ secrets.KRAKEN_API_KEY }}
      KRAKEN_API_SECRET: ${{ secrets.KRAKEN_API_SECRET }}

      # Safety flag â€“ this file is LIVE-only
      DRY_RUN: "OFF"

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then
            pip install -r requirements.txt
          else
            # Fallback in case requirements.txt is missing
            pip install requests python-dotenv
          fi

      - name: Run LIVE rotation bot
        run: |
          echo "ðŸš¨ LIVE MODE: DRY_RUN=${DRY_RUN} ðŸš¨"
          echo "SYMBOL=${SYMBOL}"
          echo "BUY_USD=${BUY_USD}, TP_PCT=${TP_PCT}, SL_PCT=${SL_PCT}"
          python kraken_live_main.py
