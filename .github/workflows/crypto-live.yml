name: Crypto Live (Every 4h â€” Auto-Pick)

on:
  schedule:
    - cron: "0 */4 * * *"
  workflow_dispatch:

jobs:
  trade:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Sanity check which API env names are present (no values shown)
        env:
          KRAKEN_API_KEY: ${{ secrets.KRAKEN_API_KEY }}
          KRAKEN_API_SECRET: ${{ secrets.KRAKEN_API_SECRET }}
          KRAKEN_KEY: ${{ secrets.KRAKEN_API_KEY }}
          KRAKEN_SECRET: ${{ secrets.KRAKEN_API_SECRET }}
          API_KEY: ${{ secrets.KRAKEN_API_KEY }}
          API_SECRET: ${{ secrets.KRAKEN_API_SECRET }}
        run: |
          for v in KRAKEN_API_KEY KRAKEN_API_SECRET KRAKEN_KEY KRAKEN_SECRET API_KEY API_SECRET; do
            if [ -z "${!v}" ]; then echo "$v=EMPTY"; else echo "$v=SET"; fi
          done

      - name: Run Crypto Trader (Auto-Pick)
        env:
          DRY_RUN: "False"
          EXCHANGE: "kraken"
          QUOTE: "USD"
          AUTO_PICK: "True"
          PICKS: "2"
          PER_TRADE_USD: "25"
          DAILY_CAP_USD: "1000000"
          MIN_QUOTE_VOL_USD: "2000000"
          MIN_RAISE_USD: "10"
          AVOID_REBUY: "False"
          TP_PCT: "0.025"
          SL_PCT: "0.015"
          TREND_FILTER: "True"
          COOL: "60m"
          # provide all common key names
          KRAKEN_API_KEY: ${{ secrets.KRAKEN_API_KEY }}
          KRAKEN_API_SECRET: ${{ secrets.KRAKEN_API_SECRET }}
          KRAKEN_KEY: ${{ secrets.KRAKEN_API_KEY }}
          KRAKEN_SECRET: ${{ secrets.KRAKEN_API_SECRET }}
          API_KEY: ${{ secrets.KRAKEN_API_KEY }}
          API_SECRET: ${{ secrets.KRAKEN_API_SECRET }}
        run: |
          python trader/crypto_engine.py
